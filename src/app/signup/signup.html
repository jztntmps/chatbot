<main class="signup">
  <section class="signup__card">
    <button type="button" class="signup__back" (click)="goHome()" aria-label="Back">
      <img src="/assets/previous.png" alt="" />
    </button>

    <div class="signup__inner">
      <div class="signup__form-wrap">
        <h2 class="signup__title">Sign Up</h2>

        <form class="signup__form" [formGroup]="form" (ngSubmit)="onSubmit()">
          <label class="field">
            <span class="field__icon" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M12 12c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5Z" stroke="currentColor" stroke-width="1.5"/>
                <path d="M4 20c0-3.31 2.69-6 6-6h4c3.31 0 6 2.69 6 6" stroke="currentColor" stroke-width="1.5"/>
              </svg>
            </span>

            <input
              #usernameInput
              class="field__input"
              formControlName="username"
              type="text"
              placeholder="Username"
              (input)="onUsernameInput()"
            />
          </label>

          <p class="err" *ngIf="(f.username.touched || f.username.dirty) && f.username.invalid">
            <ng-container *ngIf="f.username.errors?.['required']">Username is required.</ng-container>
            <ng-container *ngIf="!f.username.errors?.['required'] && f.username.errors?.['minlength']">
              Username must be at least 3 characters.
            </ng-container>
            <ng-container *ngIf="!f.username.errors?.['required'] && !f.username.errors?.['minlength'] && f.username.errors?.['backendTaken']">
              {{ usernameError || 'Username already exists.' }}
            </ng-container>
          </p>

          <label class="field">
            <span class="field__icon" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.6"/>
                <path d="M4 6.5 12 12l8-5.5" stroke="currentColor" stroke-width="1.6"/>
              </svg>
            </span>

            <input
              #emailInput
              class="field__input"
              formControlName="email"
              type="email"
              placeholder="Email"
              (input)="onEmailInput()"
            />
          </label>

          <p class="err" *ngIf="(f.email.touched || f.email.dirty) && f.email.invalid">
            <ng-container *ngIf="f.email.errors?.['required']">Email is required.</ng-container>
            <ng-container *ngIf="!f.email.errors?.['required'] && f.email.errors?.['emailFormat']">
              Please enter a valid email (example: name@gmail.com).
            </ng-container>
            <ng-container *ngIf="!f.email.errors?.['required'] && f.email.errors?.['emailDomainNotAllowed']">
              Allowed domains: .com, .net, .org, .edu, .gov, .io, .co, .ph (and .com.ph etc).
            </ng-container>
            <ng-container *ngIf="!f.email.errors?.['required'] && !f.email.errors?.['emailFormat'] && !f.email.errors?.['emailDomainNotAllowed'] && f.email.errors?.['backendTaken']">
              {{ emailError || 'Email already exists.' }}
            </ng-container>
          </p>

          <label class="field">
            <span class="field__icon" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <rect x="4" y="10" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.6"/>
                <path d="M8 10V7a4 4 0 1 1 8 0v3" stroke="currentColor" stroke-width="1.6"/>
              </svg>
            </span>

            <input
              class="field__input"
              formControlName="password"
              type="password"
              placeholder="Password"
            />
          </label>

          <div class="rules" *ngIf="f.password.touched || f.password.dirty">
            Minimum 6 characters, must include uppercase, lowercase, number, and special character.
          </div>

          <p class="err" *ngIf="(f.password.touched || f.password.dirty) && f.password.invalid">
            Password is not strong enough.
          </p>

          <label class="field">
            <span class="field__icon" aria-hidden="true">
              <svg width="16" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M17 11V8C17 5.23858 14.7614 3 12 3C9.23858 3 7 5.23858 7 8V11" stroke="currentColor" stroke-width="1.5"/>
                <rect x="4" y="11" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.5"/>
              </svg>
            </span>

            <input
              class="field__input"
              formControlName="confirmPassword"
              type="password"
              placeholder="Confirm Password"
            />
          </label>

          <p class="err" *ngIf="form.errors?.['passwordMismatch'] && (f.confirmPassword.touched || f.confirmPassword.dirty)">
            Passwords do not match.
          </p>

          <div class="actions">
            <button class="btn btn--signup" type="submit" [disabled]="form.invalid || submitting">
              {{ submitting ? 'Signing up...' : 'Sign Up' }}
            </button>
          </div>

          <p class="err err--server" *ngIf="generalError">
            {{ generalError }}
          </p>
        </form>
      </div>

      <div class="signup__illustration" aria-hidden="true">
        <img src="/assets/signup-bot.png" alt="bot" />
      </div>
    </div>
  </section>
</main>