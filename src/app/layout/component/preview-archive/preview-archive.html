<div class="layout">
  <!-- SIDEBAR -->
  <div class="sidebar-shell" *ngIf="isLoggedIn && sidebarOpen">
    <app-sidebar
      [isOpen]="sidebarOpen"
      [username]="userEmail"
      [chats]="chats"
      (newChat)="startNewChat()"
      (openChat)="openChat($event)"
      (seeAll)="seeAll()"
      (archive)="goArchive()"
      (logout)="logout()"
    ></app-sidebar>
  </div>

  <!-- RIGHT CONTENT -->
  <main class="chatbox">
    <!-- TOPBAR -->
    <div class="topbar-shell">
      <app-topbar
        [isLoggedIn]="isLoggedIn"
        (login)="goLogin()"
        (signup)="goSignup()"
        (toggleSidebar)="toggleSidebar()"
      ></app-topbar>
    </div>

    <!-- PREVIEW AREA -->
    <section class="preview-area">
      <div class="chat-panel">
        <!-- LOADING STATE -->
        <div class="loading" *ngIf="loading">
          Loading archived conversationâ€¦
        </div>

        <!-- MESSAGES -->
        <div class="chat__messages" *ngIf="!loading">
          <div
            *ngFor="let m of messages"
            class="chat__row"
            [class.is-ai]="m.role === 'ai'"
            [class.is-user]="m.role === 'user'"
          >
            <!-- AI avatar (left) -->
            <img
              *ngIf="m.role === 'ai'"
              class="chat__avatar"
              src="/assets/profile.png"
              alt="AI"
            />

            <!-- bubble -->
            <div class="chat__bubble">
              {{ m.text }}
            </div>
          </div>

          <!-- empty state -->
          <div class="empty" *ngIf="messages.length === 0">
            No messages found in this archived chat.
          </div>
        </div>

        <!-- ARCHIVE NOTICE (ALWAYS shown on this page) -->
        <div class="archive-notice">
          <p class="archive-notice__text">
            This conversation is archived. To continue, please unarchive it first.
          </p>

          <button
            class="archive-notice__btn"
            type="button"
            (click)="unarchiveConversation()"
            [disabled]="!conversationId"
          >
            <img src="/assets/unarchive_white.png" alt="" aria-hidden="true" />
            <span>Unarchive</span>
          </button>
        </div>
      </div>
    </section>

    <app-footer></app-footer>
  </main>
</div>