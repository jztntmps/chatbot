<aside class="sidebar" [class.sidebar--closed]="!isOpen" (click)="$event.stopPropagation()">

  <div class="sidebar-header">
    <div class="sidebar__top">
      <button
        class="burger"
        type="button"
        (click)="toggle.emit(); $event.stopPropagation()"
        aria-label="Toggle sidebar"
      >
        ‚ò∞
      </button>
    </div>

    <div class="profile">
      <div class="avatar">
        <img *ngIf="avatarUrl; else fallback" [src]="avatarUrl" alt="Avatar" />
        <ng-template #fallback>
          <div class="avatar__fallback">üë§</div>
        </ng-template>
      </div>
    </div>

    <button
      class="newchat"
      type="button"
      (click)="settingsOpen = false; openMenuId = null; newChat.emit()"
    >
      <span class="newchat__plus">Ôºã</span>
      <span class="newchat__text">New Chat</span>
    </button>
  </div>

  <div class="sidebar-body">
    <div class="list">

      <div
        class="chat-card"
        *ngFor="let c of (showAll ? chats : (chats | slice:0:3)); trackBy: trackById"
        (click)="selectChat(c.id)"
      >
        <div class="chat-card__title">
          {{ c.title }}
        </div>

        <div class="chat-card__actions">
          <button
            class="chat-card__dots"
            type="button"
            (click)="openDots($event, c.id)"
            aria-label="More actions"
          >
            ‚ãØ
          </button>

          <div
            class="chat-card__menu"
            *ngIf="openMenuId === c.id"
            (click)="$event.stopPropagation()"
          >
            <button
              class="chat-card__menu-item"
              type="button"
              (click)="archiveChat(c.id)"
            >
              üìÅ <span>Archive</span>
            </button>

            <button
              class="chat-card__menu-item chat-card__menu-item--danger"
              type="button"
              (click)="deleteChat(c.id)"
            >
              üóëÔ∏è <span>Delete</span>
            </button>
          </div>
        </div>
      </div>

      <button
        class="seeall"
        type="button"
        *ngIf="chats.length > 3"
        (click)="toggleSeeAll(); $event.stopPropagation()"
      >
        {{ showAll ? 'Show Less' : 'See All' }}
      </button>

    </div>
  </div>

  <div class="sidebar-footer">
    <button
      class="settings"
      type="button"
      (click)="toggleSettings(); $event.stopPropagation()"
    >
      <span class="settings__icon">‚öô</span>
      <span class="settings__text">Settings</span>
    </button>

    <div
      class="settings-menu"
      *ngIf="settingsOpen"
      (click)="$event.stopPropagation()"
    >
      <button class="settings-menu__item" type="button" (click)="clickArchive()">
        <img class="settings-menu__icon-img" src="/assets/archive.png" alt="Archive" />
        <span>Archive</span>
      </button>

      <button
        class="settings-menu__item settings-menu__item--logout"
        type="button"
        (click)="clickLogout()"
      >
        <img class="settings-menu__icon-img" src="/assets/logout.png" alt="Logout" />
        <span>Logout</span>
      </button>
    </div>
  </div>

</aside>

<app-modal
  *ngIf="showModal"
  [userId]="userId"
  (close)="showModal=false"
 >
</app-modal>

