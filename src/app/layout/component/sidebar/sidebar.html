<!-- sidebar.html -->
<aside
  class="sidebar"
  [class.sidebar--closed]="!isOpen"
  (click)="$event.stopPropagation()"
>
  <div class="sidebar-header">
    <div class="sidebar__top">
      <!-- ✅ profile.png always visible -->
      <button
        class="profile-toggle"
        type="button"
        (click)="toggle.emit(); $event.stopPropagation()"
        aria-label="Toggle sidebar"
      >
        <img src="assets/profile.png" alt="Profile" />
      </button>

      <!-- ✅ burger only when sidebar is OPEN -->
      <button
        *ngIf="isOpen"
        class="burger"
        type="button"
        (click)="toggle.emit(); $event.stopPropagation()"
        aria-label="Toggle sidebar"
      >
        ☰
      </button>
    </div>
    <div class="profile">
      <div class="avatar">
        <img *ngIf="avatarUrl; else fallback" [src]="avatarUrl" alt="Avatar" />
        <ng-template #fallback>
          <!-- ✅ First letter of username -->
          <div class="avatar__fallback">{{ profileInitial }}</div>
        </ng-template>
      </div>
    </div>

<button
  class="newchat"
  type="button"
  (click)="settingsOpen = false; openMenuId = null; newChat.emit()"
>
  <span class="newchat__content">
    
    <!-- ✅ SVG PLUS ICON -->
    <svg
      class="newchat__icon"
      width="18"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <line x1="12" y1="5" x2="12" y2="19"></line>
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>

    <span class="newchat__text">New Chat</span>
  </span>
</button>
  </div>

  <div class="sidebar-body">
    <div class="list">
      <div
        class="chat-card"
        *ngFor="let c of (showAll ? chats : (chats | slice:0:3)); trackBy: trackById"
        (click)="selectChat(c.id)"
      >
        <div class="chat-card__title">
          {{ c.title }}
        </div>

        <div class="chat-card__actions">
          <button
            class="chat-card__dots"
            type="button"
            (click)="openDots($event, c.id)"
            aria-label="More actions"
          >
            ⋯
          </button>

          <div
            class="chat-card__menu"
            *ngIf="openMenuId === c.id"
            (click)="$event.stopPropagation()"
          >
            <button
              class="chat-card__menu-item"
              type="button"
              (click)="archiveChat(c.id)"
            >
              <img class="menu-icon" src="assets/archive.png" alt="Archive" />
              <span>Archive</span>
            </button>

            <button
              class="chat-card__menu-item"
              type="button"
              (click)="exportChat(c.id)"
            >
              <img
                class="menu-icon"
                src="assets/export_icon.png"
                alt="Export"
              />
              <span>Export</span>
            </button>

            <button
              class="chat-card__menu-item chat-card__menu-item--danger"
              type="button"
              (click)="deleteChat(c.id)"
            >
              <img class="menu-icon" src="assets/delete.png" alt="Delete" />
              <span>Delete</span>
            </button>
          </div>
        </div>
      </div>

      <button
        class="seeall"
        type="button"
        *ngIf="chats.length > 3"
        (click)="toggleSeeAll(); $event.stopPropagation()"
      >
        {{ showAll ? 'Show Less' : 'See All' }}
      </button>
    </div>
  </div>

  <div class="sidebar-footer">
    <button
      class="settings"
      type="button"
      (click)="toggleSettings(); $event.stopPropagation()"
    >
      <span class="settings__icon">⚙</span>
      <span class="settings__text">Settings</span>
    </button>

    <div
      class="settings-menu"
      *ngIf="settingsOpen"
      (click)="$event.stopPropagation()"
    >
      <button
        class="settings-menu__item"
        type="button"
        (click)="clickArchive()"
      >
        <img
          class="settings-menu__icon-img"
          src="/assets/archive.png"
          alt="Archive"
        />
        <span>Archive</span>
      </button>

      <button
        class="settings-menu__item settings-menu__item--logout"
        type="button"
        (click)="clickLogout()"
      >
        <img
          class="settings-menu__icon-img"
          src="/assets/logout.png"
          alt="Logout"
        />
        <span>Logout</span>
      </button>
    </div>
  </div>
</aside>
<app-modal
  *ngIf="showModal"
  [userId]="userId"
  (close)="showModal=false"
  (changed)="onArchiveChanged()"
></app-modal>