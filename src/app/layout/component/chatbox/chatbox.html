<div class="layout" [class.layout--sidebar-closed]="isLoggedIn && !sidebarOpen">
<!-- SIDEBAR -->
<div class="sidebar-shell" *ngIf="isLoggedIn">
  <app-sidebar
    [isOpen]="sidebarOpen"
    [username]="userEmail"
    [chats]="chats"
    [userId]="userId"
    (toggle)="toggleSidebar()"
    (newChat)="startNewChat()"
    (openChat)="openChat($event)"
    (seeAll)="seeAll()"
    (settings)="openSettings()"
    (archive)="goArchive()"
    (logout)="logout()"
    (deleteChatId)="onDeleteChat($event)"
    (archiveChatId)="onArchiveChat($event)"
  ></app-sidebar>
</div>
  <!-- RIGHT CONTENT -->
  <main class="chatbox">
    <div class="topbar-shell">
      <app-topbar
        [isLoggedIn]="isLoggedIn"
        (login)="goLogin()"
        (signup)="goSignup()"
        [messages]="messages"
        (exportChat)="exportConversationPdf()"
      ></app-topbar>
    </div>


    <!-- CHAT AREA -->
    <section class="chat">

      <div class="chat__header" *ngIf="messages.length === 0">
        <h1 class="headline">Here when you need me.</h1>
        <p class="sub">Type a message and I'll respond.</p>
      </div>

      <div class="chat__messages" role="log" aria-live="polite">
        <div
          class="msg"
          *ngFor="let m of messages"
          [class.msg--user]="m.role === 'user'"
          [class.msg--ai]="m.role === 'ai'"
        >
          <!-- ✅ AI avatar (only shows for bot messages) -->
          <img
            *ngIf="m.role === 'ai'"
            class="msg__avatar"
            src="assets/profile.png"
            alt="Bot"
          />

          <div class="msg__bubble">{{ m.text }}</div>
        </div>

        <div class="typing" *ngIf="sending">
          <div class="typing__bubble">
            <span class="typing__dot"></span>
            <span class="typing__dot"></span>
            <span class="typing__dot"></span>
          </div>
        </div>
      </div>

      <form class="prompt" autocomplete="off" (ngSubmit)="sendMessage()">
        <input
          class="prompt__input"
          type="text"
          name="message"
          placeholder="Ask me anything..."
          [(ngModel)]="message"
          [disabled]="sending"
        />

        <button
          class="prompt__send"
          type="submit"
          [disabled]="sending || !message.trim()"
          [class.prompt__send--disabled]="sending || !message.trim()"
        >
          <span class="prompt__arrow" *ngIf="!sending">➤</span>
          <span class="prompt__loading" *ngIf="sending">◌</span>
        </button>
      </form>
    </section>

    <app-footer></app-footer>
  </main>
</div>
